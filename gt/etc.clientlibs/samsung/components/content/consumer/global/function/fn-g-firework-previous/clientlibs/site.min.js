(function(){var d=window.sg.common.$q,c=function(h){var e=this;this.el={section:d(h)};this.handler={resize:function(){e.setMaxHeight()}};c.instances.set(h,this);this.init()};c.prototype.setElements=function(){0===this.el.section.find(".fn19-firework-previous__item").target.length?this.el.section.hide():this.el.section.show()};c.prototype.init=function(){this.setElements();this.bindEvents()};c.prototype.reInit=function(){this.setElements();this.bindEvents()};c.prototype.bindEvents=function(){window.sg.common.icon.update(this.el.section.target[0]);
d(window).off("resize",this.handler.resize).on("resize",this.handler.resize);this.handler.resize()};c.prototype.setMaxHeight=function(){var c=this.el.section.find(".fn19-firework-previous__product-name");c.css({height:""});if("desktop"===window.sg.common.utils.getCurrentDevice()){var e=[],g=0;c.target.forEach(function(c,h){e.push(c);c.offsetHeight>g&&(g=c.offsetHeight);3===h%4&&(d(e).css({height:g+"px"}),e=[],g=0)});1<e.length&&d(e).css({height:g+"px"})}};c.instances=new WeakMap;window.sg.components.fireworkPrevious=
{init:function(){d(".fn19-firework-previous").target.forEach(function(d){c.instances.has(d)?c.instances.get(d).reInit():new c(d)});window.sg.common.lazyLoad.initAll()}}})();
(function(d,c,h,e){function g(a){var k={page:a.curPage,page_size:4,status:"replay"};a.beforeId&&(k.before_id=a.beforeId);d.ajax({url:a.apiUri,data:k,type:"GET",dataType:"json",beforeSend:function(b){b.setRequestHeader("Authorization",a.apiToken);b.setRequestHeader("Content-Type","application/json")},success:function(b){if(b&&b.live_streams)if(1!==a.curPage||b.live_streams.length){for(var q=b.live_streams,k=d("\x3cul\x3e\x3c/ul\x3e"),e=k.get(0),g=a.$ui.find("ul.sdf-comp-list-panel").get(0),h=0;h<q.length;h++){var f=
q[h],p=f.event_name,m=f.video_posters[0];if(1<f.video_posters.length&&"vertical"!==m.orientation)for(var l=0;l<f.video_posters.length;l++)if("vertical"===f.video_posters[l].orientation){m=f.video_posters[l];break}var n=f.duration||0;l=Math.floor(n/3600);var r=Math.floor(n%3600/60);n%=60;f={id:f.id,videoId:f.trailer.encoded_id,showLength:(10>l?"0"+l:l)+":"+(10>r?"0"+r:r)+":"+(10>n?"0"+n:n),title:p,image:m?m.url:"/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/upcoming-default.jpg",
mobileImage:m?m.url:"/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/upcoming-default.jpg",imageAlt:p,origin:f};a.invokeTemplate("previousCard",{previous:f},e);p=k.find("li.sdf-comp-previous-item");g.appendChild(p.get(0));v(a,f,p)}k.remove();c.init();a.nextPageEnabled=b.paging&&b.paging.next&&0<b.paging.next.length;a.nextPageEnabled?(b=w(b.paging.next),a.beforeId=b.before_id,console.log("[FN19] Next page detected: beforeId\x3d"+a.beforeId)):console.log("[FN19] No more page");
b=a.$ui.viewMorePanel;q=a.$ui.viewMoreCta;a.nextPageEnabled?b.show():(q.off("click"),b.hide());a.$ui.show()}else console.info("[FN19] Empty playlist: id\x3d"+a.playlistId);else console.error("[FN19] Can't retrieve previous playlist: bad response")},error:function(b){401===b.status?(console.log("[FN19] Token has expired."),a.authFailure=!0,u(a,g)):console.error("[FN19] Can't load playlist: "+a.playlistId)}})}function v(a,c,b){var k=c.id,e="https://api.firework.tv/api/oauth_app/live_streams/"+k+"/detail";
d.ajax({url:e,type:"GET",dataType:"json",beforeSend:function(b){b.setRequestHeader("Authorization",a.apiToken);b.setRequestHeader("Content-Type","application/json")},success:function(a){a&&a.insights?(b.find("span.sdf-comp-like-count").text(t(a.insights.likes_count||0)),b.find("span.sdf-comp-view-count").text(t(a.insights.viewers_count||0))):console.error("[FN19] Can't retrieve previous video detail: bad response; url\x3d"+e)},error:function(){console.error("[FN19] Can't retrieve previous insights: AJAX failure: id\x3d"+
k)}})}function t(a){if("number"===typeof a)a=a.toString();else if(isNaN(a)||"string"!==typeof a)a="0";return a.replace(/\B(?=(\d{3})+(?!\d))/g,",")}function w(a){var c={},b=a.indexOf("?");0<b&&(a=d.trim(a.substring(b+1)),b=a.indexOf("#"),0<b&&(a=d.trim(a.substring(0,b))),a.split("\x26").forEach(function(a){a=a.split("\x3d");c[a[0]]=a[1]}));return c}function u(a,c){d.ajax({url:a.tokenUrl,type:"GET",data:{sbscCode:a.subsidiary},dataType:"json",success:function(b){b&&b.response&&b.response.resultData?
(b="Bearer "+b.response.resultData.tokenValue,a.authFailure&&a.apiToken===b?console.error("[FN19] Auth failure"):(a.apiToken=b,c&&c(a))):console.error("[FN19] Can't retrieve firework API token from SearchAPI")},error:function(){console.error("[FN19] Can't retrieve firework API token from SearchAPI")}})}function x(a){a.subsidiary=d.trim(a.meta("subsidiary")||"");""===a.subsidiary?console.error("[FN19] Subsidiary (Client ID) has not specified"):(a.searchApiDomain=a.meta("tokenProvider"),a.channelId=
a.meta("channelId"),a.playlistId=a.meta("playlistId"),a.tokenUrl=a.searchApiDomain+"/front/b2c/promotion/liveCommerce/fireworkToken",a.apiUri="https://api.firework.tv/api/oauth_app/live_streams/playlists/"+a.playlistId+"/videos",a.curPage=1,a.$ui.viewMorePanel=a.$ui.find(".sdf-comp-viewmore-cta"),a.$ui.viewMoreCta=a.$ui.viewMorePanel.find("button.cta"),a.$ui.viewMoreCta.on("click",function(){a.curPage++;g(a)}),u(a,g))}d(function(){if(!window._fireworkPreviousInitialized){window._fireworkPreviousInitialized=
!0;var a=e.dispatch(".fn19-firework-previous.sdf-comp-dynamic-component");(window.fn19FireworkPrevious=a)&&x(a)}})})(jQuery,window.sg.components.fireworkPrevious,window.sg.sdf.util,window.sg.sdf.comp);