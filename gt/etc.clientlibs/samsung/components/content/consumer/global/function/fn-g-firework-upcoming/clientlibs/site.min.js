(function(){var d=window.sg.common.$q,f=function(l){this.el={section:d(l)};f.instances.set(l,this);this.init()};f.prototype.setElements=function(){0===this.el.section.find(".fn18-firework-upcoming__item").target.length?this.el.section.hide():this.el.section.show()};f.prototype.init=function(){this.setElements();window.sg.common.icon.update(this.el.section.target[0])};f.prototype.reInit=function(){this.setElements();window.sg.common.icon.update(this.el.section.target[0])};f.instances=new WeakMap;window.sg.components.fireworkUpcoming=
{init:function(){d(".fn18-firework-upcoming").target.forEach(function(d){f.instances.has(d)?f.instances.get(d).reInit():new f(d)});window.sg.common.lazyLoad.initAll()}}})();
(function(d,f,l,u){function m(a){var e={page:a.curPage,page_size:4,status:"idle"};a.beforeId&&(e.before_id=a.beforeId);d.ajax({url:a.apiUri,data:e,type:"GET",dataType:"json",beforeSend:function(b){b.setRequestHeader("Authorization",a.apiToken);b.setRequestHeader("Content-Type","application/json")},success:function(b){if(b&&b.live_streams)if(1!==a.curPage||b.live_streams.length){for(var n=b.live_streams,e=d("\x3cul\x3e\x3c/ul\x3e"),l=e.get(0),m=a.$ui.find("ul.sdf-comp-list-panel").get(0),r=0;r<n.length;r++){var c=
n[r],t=c.event_name,h=c.video_posters[0];if(1<c.video_posters.length&&"vertical"!==h.orientation)for(var k=0;k<c.video_posters.length;k++)if("vertical"===c.video_posters[k].orientation){h=c.video_posters[k];break}k=c.trailer.encoded_id;var g;if(!(g=c.scheduled_at_formatted)){g=new Date(c.scheduled_at);var p=g.getHours(),q=12>p?"AM":"PM";12<p&&(p-=12);g=g.getMonth()+1+"/"+g.getDate()+" "+p+" "+q}c={id:k,datetime:g,title:t,titleTagging:t.replace(/"/g,"\x26quote;"),description:c.event_description,image:h?
h.url:"/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/upcoming-default.jpg",mobileImage:h?h.url:"/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/upcoming-default.jpg",imageAlt:t,origin:c};a.invokeTemplate("upcomingCard",{upcoming:c},l);c=e.find("li.sdf-comp-upcoming-item").get(0);m.appendChild(c)}e.remove();f.init();a.nextPageEnabled=b.paging&&b.paging.next&&0<b.paging.next.length;a.nextPageEnabled?(b=v(b.paging.next),a.beforeId=
b.before_id,console.log("[FN18] Next page detected: beforeId\x3d"+a.beforeId)):console.log("[FN18] No more page");b=a.$ui.viewMorePanel;n=a.$ui.viewMoreCta;a.nextPageEnabled?b.show():(n.off("click"),b.hide());a.$ui.show();b=a.$ui.find(".fn18-firework-upcoming__cta fw-add-to-calendar");"mobile"===w?b.attr("popup_position","top center"):b.attr("popup_position","center")}else console.info("[FN18] Empty playlist: id\x3d"+a.playlistId);else console.error("[FN18] Can't retrieve upcoming playlist: bad response")},
error:function(b){401===b.status?(console.log("[FN18] Token has expired"),a.authFailure=!0,q(a,m)):console.error("[FN18] Can't load playlist: "+a.playlistId)}})}function v(a){var e={},b=a.indexOf("?");0<b&&(a=d.trim(a.substring(b+1)),b=a.indexOf("#"),0<b&&(a=d.trim(a.substring(0,b))),a.split("\x26").forEach(function(a){a=a.split("\x3d");e[a[0]]=a[1]}));return e}function q(a,e){d.ajax({url:a.tokenUrl,type:"GET",data:{sbscCode:a.subsidiary},dataType:"json",success:function(b){b&&b.response&&b.response.resultData?
(b="Bearer "+b.response.resultData.tokenValue,a.authFailure&&a.apiToken===b?console.error("[FN19] Auth failure"):(a.apiToken=b,e&&e(a))):console.error("[FN18] Can't retrieve firework API token from SearchAPI")},error:function(){console.error("[FN18] Can't retrieve firework API token from SearchAPI")}})}function x(a){a.subsidiary=d.trim(a.meta("subsidiary")||"");""===a.subsidiary?console.error("[FN18] Subsidiary (Client ID) has not specified"):(a.searchApiDomain=a.meta("tokenProvider"),a.channelId=
a.meta("channelId"),a.playlistId=a.meta("playlistId"),a.tokenUrl=a.searchApiDomain+"/front/b2c/promotion/liveCommerce/fireworkToken",a.apiUri="https://api.firework.tv/api/oauth_app/live_streams/playlists/"+a.playlistId+"/videos",a.curPage=1,a.$ui.viewMorePanel=a.$ui.find(".sdf-comp-viewmore-cta"),a.$ui.viewMoreCta=a.$ui.viewMorePanel.find("button.cta"),a.$ui.viewMoreCta.on("click",function(){a.curPage++;m(a)}),q(a,m))}var w=window.sg.common.utils.getCurrentDevice();d(function(){if(!window._fireworkUpcomingInitialized){window._fireworkUpcomingInitialized=
!0;var a=u.dispatch(".fn18-firework-upcoming.sdf-comp-dynamic-component");(window.fn18FireworkUpcoming=a)&&x(a)}})})(jQuery,window.sg.components.fireworkUpcoming,window.sg.sdf.util,window.sg.sdf.comp);